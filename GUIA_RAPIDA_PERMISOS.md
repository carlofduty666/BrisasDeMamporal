# GuÃ­a RÃ¡pida - Sistema de Permisos

## ğŸ¯ UbicaciÃ³n en la UI

### UsuariosManager (`/admin/usuarios`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GESTIÃ“N DE USUARIOS                           â”‚
â”‚  â† Volver  ğŸ‘¥ Total: 5 usuarios | âœ“ Verificados: 4             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Buscar por nombre, email o cÃ©dula...    [Tabla] [Tarjetas]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           VISTA TABLA                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Usuario    â”‚ Email      â”‚ **ROL**  â”‚ TelÃ©fono â”‚ Estado â”‚ Accionesâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Juan P.    â”‚ juan@...   â”‚ğŸŸ Admin  â”‚ 0412...  â”‚ âœ“      â”‚âœ“ğŸ›¡ï¸ğŸ”‘âŒ â”‚
â”‚ MarÃ­a G.   â”‚ maria@...  â”‚ğŸ”µAdm    â”‚ 0414...  â”‚ âœ“      â”‚âœ“ğŸ›¡ï¸ğŸ”‘âŒ â”‚
â”‚ Carlos L.  â”‚ carlos@... â”‚ğŸŸ Admin  â”‚ 0416...  â”‚ âš ï¸     â”‚ ğŸ›¡ï¸ğŸ”‘âŒ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Botones por usuario:
âœ“ = Verificar (si no estÃ¡ verificado)
ğŸ›¡ï¸ = Gestionar Permisos â† NUEVO
ğŸ”‘ = Restablecer ContraseÃ±a
âŒ = Eliminar Usuario
```

## ğŸ›¡ï¸ Modal de Gestionar Permisos

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ›¡ï¸  GESTIONAR PERMISOS                                           â•‘
â•‘      Juan Pablo Ruiz                                              â•‘
â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢
â•‘  Tipo de usuario: ğŸŸ  Administrativo                               â•‘
â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢
â•‘                                                                   â•‘
â•‘  ğŸ“š ACADÃ‰MICO                                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â˜‘ ver_grados          Visualizar listado de grados         â”‚ â•‘
â•‘  â”‚ â˜ editar_grados       Editar informaciÃ³n de grados         â”‚ â•‘
â•‘  â”‚ â˜‘ ver_secciones       Visualizar listado de secciones      â”‚ â•‘
â•‘  â”‚ â˜‘ editar_secciones    Editar informaciÃ³n de secciones      â”‚ â•‘
â•‘  â”‚ â˜ ver_materias        Visualizar listado de materias       â”‚ â•‘
â•‘  â”‚ â˜ editar_materias     Editar informaciÃ³n de materias       â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                   â•‘
â•‘  ğŸ‘¥ ESTUDIANTES                                                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â˜‘ ver_estudiantes     Visualizar listado de estudiantes    â”‚ â•‘
â•‘  â”‚ â˜ editar_estudiantes  Editar informaciÃ³n de estudiantes    â”‚ â•‘
â•‘  â”‚ â˜‘ ver_inscripciones   Visualizar inscripciones             â”‚ â•‘
â•‘  â”‚ â˜ editar_inscripciones                                     â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                   â•‘
â•‘  ğŸ’° PAGOS                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â˜‘ ver_pagos           Visualizar pagos                     â”‚ â•‘
â•‘  â”‚ â˜‘ editar_pagos        Editar pagos                         â”‚ â•‘
â•‘  â”‚ â˜‘ ver_aranceles       Visualizar aranceles                 â•‘
â•‘  â”‚ â˜ editar_aranceles    Editar aranceles                     â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                                   â•‘
â•‘  [Cancelar]  [âœ“ Guardar Cambios]                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ“‹ Tabla de Tipos de Usuario y Colores

```
Tipo              Color    Acceso              Permisos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸŸ£ owner          PÃºrpura  ACCESO TOTAL        N/A
ğŸ”µ adminWeb       Azul     ACCESO TOTAL        N/A
ğŸŸ  administrativo  Naranja  LIMITADO (asignado) âœ… Gestionar
ğŸŸ¢ profesor       Verde    FIJO (su mÃ³dulo)    âŒ No
ğŸŸ£ estudiante     Ãndigo   FIJO (su mÃ³dulo)    âŒ No
ğŸ”· representante  Cian     FIJO (su mÃ³dulo)    âŒ No
```

## ğŸ”‘ CategorÃ­as de Permisos

```
ACADÃ‰MICO (10)
â”œ ver_grados
â”œ editar_grados
â”œ ver_secciones
â”œ editar_secciones
â”œ ver_materias
â”œ editar_materias
â”œ ver_horarios
â”œ editar_horarios
â”œ ver_cupos
â”” editar_cupos

ESTUDIANTES (4)
â”œ ver_estudiantes
â”œ editar_estudiantes
â”œ ver_inscripciones
â”” editar_inscripciones

REPRESENTANTES (2)
â”œ ver_representantes
â”” editar_representantes

PROFESORES (2)
â”œ ver_profesores
â”” editar_profesores

EMPLEADOS (2)
â”œ ver_empleados
â”” editar_empleados

PAGOS (4)
â”œ ver_pagos
â”œ editar_pagos
â”œ ver_aranceles
â”” editar_aranceles

NÃ“MINA (2)
â”œ ver_nomina
â”” editar_nomina

REPORTES (2)
â”œ ver_reportes
â”” descargar_reportes

CONFIGURACIÃ“N (4)
â”œ ver_configuracion
â”œ editar_configuracion
â”œ ver_periodo_escolar
â”” editar_periodo_escolar

USUARIOS (3)
â”œ ver_usuarios
â”œ editar_usuarios
â”” gestionar_permisos
```

## âš™ï¸ API Endpoints

### Obtener Permisos

```
GET /api/permisos
â†’ Todos los permisos

GET /api/permisos/usuario/5
â†’ Permisos de usuario ID 5 (combinados: rol + usuario)

GET /api/permisos/categoria/pagos
â†’ Solo permisos de la categorÃ­a "pagos"
```

### Gestionar Permisos

```
POST /api/permisos/usuario/asignar-multiples
Body:
{
  "usuarioID": 5,
  "permisoIDs": [1, 2, 3, 5, 10, 15, 18]
}
â†’ Asigna TODOS estos permisos al usuario
â†’ Reemplaza permisos anteriores

POST /api/permisos/usuario/asignar
Body:
{
  "usuarioID": 5,
  "permisoID": 1
}
â†’ Agrega UN permiso al usuario

DELETE /api/permisos/usuario/remover
Body:
{
  "usuarioID": 5,
  "permisoID": 1
}
â†’ Remueve UN permiso del usuario
```

## ğŸ”§ Uso en Componentes

### Hook: usePermissions()

```javascript
import { usePermissions } from '../hooks/usePermissions';

const MiComponente = () => {
  const { 
    hasPermission,      // Â¿Tiene UN permiso?
    hasAnyPermission,   // Â¿Tiene ALGUNO de estos permisos?
    hasAllPermissions,  // Â¿Tiene TODOS estos permisos?
    isAdmin,            // Â¿Es owner o adminWeb?
    isAdministrativo,   // Â¿Es administrativo?
    getPermissions,     // Obtener array de permisos
    getUserType,        // Obtener tipo de usuario
    permissions,        // Array directo de permisos
    userType,           // Tipo directo del usuario
    loading             // Â¿Cargando?
  } = usePermissions();

  // Ejemplos:
  if (loading) return <div>Cargando...</div>;

  if (hasPermission('ver_pagos')) {
    // Mostrar mÃ³dulo de pagos
  }

  if (hasAnyPermission(['ver_pagos', 'ver_reportes'])) {
    // Mostrar si tiene ALGUNO de estos permisos
  }

  if (hasAllPermissions(['ver_pagos', 'editar_pagos'])) {
    // Mostrar si tiene AMBOS permisos
  }

  if (isAdmin()) {
    // Usuario es owner o adminWeb
  }

  return (
    <div>
      <p>Tus permisos: {permissions.join(', ')}</p>
      <p>Tipo: {userType}</p>
    </div>
  );
};
```

### Componente: ProtectedRoute

```javascript
import ProtectedRoute from '../ProtectedRoute';

<ProtectedRoute 
  permissions="ver_pagos"
  fallback={<AccesoDenegado />}
>
  <PagosPage />
</ProtectedRoute>

// MÃºltiples permisos (requiere AL MENOS UNO):
<ProtectedRoute 
  permissions={["ver_pagos", "ver_reportes"]}
>
  <PagosPage />
</ProtectedRoute>

// MÃºltiples permisos (requiere TODOS):
<ProtectedRoute 
  permissions={["ver_pagos", "editar_pagos"]}
  requireAll={true}
>
  <PagosPage />
</ProtectedRoute>
```

## ğŸš€ Pasos para Usar

### 1ï¸âƒ£ Inicializar Permisos

```bash
cd backend
node seeders/seed-permisos.js
# Output: "Permisos iniciales creados exitosamente."
```

### 2ï¸âƒ£ Reiniciar Servidor

```bash
cd backend
npm start
# El servidor debe reiniciarse
```

### 3ï¸âƒ£ Login con Usuario Administrativo

```bash
POST http://localhost:5000/login
{
  "email": "admin@school.com",
  "password": "password123"
}

# Response incluye:
{
  "token": "...",
  "user": {
    "id": 5,
    "email": "admin@school.com",
    "tipo": "administrativo",
    "permisos": ["ver_pagos", "editar_pagos", ...]
  }
}
```

### 4ï¸âƒ£ Gestionar Permisos

1. Abrir: `http://localhost:5173/admin/usuarios`
2. Buscar usuario administrativo
3. Hacer clic en botÃ³n ğŸ›¡ï¸
4. Marcar/desmarcar permisos
5. Hacer clic en "Guardar Cambios"

### 5ï¸âƒ£ Verificar Permisos

```javascript
// En Console del navegador
const user = JSON.parse(localStorage.getItem('user'));
console.log('Permisos:', user.permisos);
```

## ğŸ”’ Flujo de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO INTENTA ACCEDER A MÃ“DULO                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Frontend       â”‚
      â”‚ usePermissions() â”‚â”€â”€â–¶ Â¿Tiene permiso?
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
    â–¼                 â–¼
  âŒ NO            âœ… SÃ
  Muestra        Permite
  "Acceso        acceso
  Denegado"
    â”‚                 â”‚
    â”‚           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚ Backend      â”‚
    â”‚           â”‚ Middleware   â”‚
    â”‚           â”‚ verifyToken()â”‚
    â”‚           â”‚ Â¿Permiso en  â”‚
    â”‚           â”‚ token?       â”‚
    â”‚           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                 â”‚
    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚                 â”‚
    â”‚        â–¼                 â–¼
    â”‚      âŒ NO            âœ… SÃ
    â”‚      401/403        Retorna
    â”‚      Error          datos
    â”‚        â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Ejemplo Real: Setup Administrativo

### Usuario: MarÃ­a GarcÃ­a (Administrativa de Pagos)

**Setup**:
```
Nombre: MarÃ­a GarcÃ­a
Email: maria.garcia@school.com
TelÃ©fono: 0412-1234567
Tipo: administrativo
Permisos asignados:
  âœ“ ver_pagos
  âœ“ editar_pagos
  âœ“ ver_aranceles
  âœ“ editar_aranceles
  âœ“ descargar_reportes
  âœ“ ver_configuracion
```

**Acceso**:
- âœ… Puede ver/editar pagos de estudiantes
- âœ… Puede ver/editar aranceles
- âœ… Puede descargar reportes de pagos
- âœ… Puede ver configuraciÃ³n general
- âŒ NO puede ver estudiantes
- âŒ NO puede ver empleados
- âŒ NO puede ver nÃ³mina
- âŒ NO puede editar perÃ­odo escolar

## ğŸ› Troubleshooting

### Error: "Los permisos ya existen"
â†’ Los seeders ya fueron ejecutados. Si necesitas recrearlos:
```bash
# 1. Borrar tabla de permisos en BD
DELETE FROM Permisos;
DELETE FROM Rol_Permisos;
DELETE FROM Usuario_Permisos;

# 2. Ejecutar seeders de nuevo
node seeders/seed-permisos.js
```

### Error: "Acceso Denegado" sin motivo
â†’ Verifique:
1. Token vÃ¡lido: `localStorage.getItem('token')`
2. Permisos en user: `JSON.parse(localStorage.getItem('user')).permisos`
3. Hacer logout/login de nuevo

### Los permisos no se actualizan
â†’ Luego de actualizar permisos, el usuario debe hacer logout y login de nuevo para obtener nuevo token con permisos actualizados.

## ğŸ“ Soporte

Para ver la documentaciÃ³n completa: `SISTEMA_PERMISOS_ROLES.md`

---

**VersiÃ³n**: 1.0.0  
**Ãšltima actualizaciÃ³n**: 2025